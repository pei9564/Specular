services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    working_dir: /app
    command: ["pytest", "tests/", "-v"]

  test:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    working_dir: /app
    command: ["pytest", "tests/", "-v"]

  report:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    working_dir: /app
    command: >
      pytest tests/ -v
      --html=reports/test-report.html --self-contained-html
      --junitxml=reports/junit.xml

  lint:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    working_dir: /app
    command: ["mypy", "app/"]

  # Placeholder: uncomment when database integration feature is implemented
  # db:
  #   image: postgres:16-alpine
  #   environment:
  #     POSTGRES_USER: specular
  #     POSTGRES_PASSWORD: specular
  #     POSTGRES_DB: specular_dev
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data

# volumes:
#   pgdata:
