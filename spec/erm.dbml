Table Users {
    id string [pk, note: "User ID"]
    name string [note: "User Name"]
    email string [note: "User Email"]
    created_at string
    note: "Platform users"
}

Table Agents {
    id string [pk, note: "Agent ID (UUID)"]
    name string [note: "Agent Name, unique for usage"]
    owner_id string [note: "Creator User ID"]
    status string [note: "active, inactive, archived"]
    mode string [note: "chat, triggers"]
    model_id string [note: "Primary LLM Model ID"]
    system_prompt string [note: "Default System Prompt"]
    model_config json [note: "JSON configuration for model parameters"]
    memory_config json [note: "JSON configuration for memory"]
    created_at string
    updated_at string
    note: "AI Agents configuration"
}

Table Conversations {
    id string [pk, note: "Conversation ID (thread_id)"]
    user_id string [note: "User ID"]
    agent_id string [note: "Agent ID"]
    status string [note: "active, archived"]
    message_count int
    last_message_at string
    created_at string
    updated_at string
    note: "Chat threads between User and Agent"
}

Table Messages {
    id string [pk, note: "Message ID"]
    conversation_id string [note: "Conversation ID"]
    run_id string [note: "Trace ID / Run ID if generated by Agent"]
    role string [note: "user, assistant, system, tool"]
    content string [note: "Message content"]
    status string [note: "complete, incomplete (if interrupted)"]
    created_at string
    note: "Individual messages in a conversation"
}

Table ToolCalls {
    id string [pk, note: "Tool Call ID"]
    message_id string [note: "The assistant message that triggered this call"]
    tool_type string [note: "skill, mcp"]
    tool_name string
    input json [note: "Arguments passed to tool"]
    output json [note: "Result from tool"]
    status string [note: "success, failed"]
    duration_ms int
    error string
    created_at string
    note: "Tool execution records"
}

Table Runs {
    id string [pk, note: "Run ID / Trace ID"]
    conversation_id string [note: "Conversation ID"]
    status string [note: "created, processing, completed, failed"]
    timestamp string
    input json
    usage json
    note: "Represents a single inference execution flow"
}

Table TokenUsage {
    id string [pk]
    user_id string
    agent_id string
    model_id string
    prompt_tokens int
    completion_tokens int
    created_at string
    note: "Usage tracking for billing/limits"
}

Table Triggers {
    id string [pk, note: "Trigger ID"]
    agent_id string [note: "Owner Agent ID"]
    type string [note: "schedule, webhook, event"]
    name string [note: "Trigger Name"]
    config json [note: "Configuration specific to type (cron, filter, etc)"]
    input_template string [note: "Template string for input generation"]
    status string [note: "active, paused"]
    next_run_at string
    last_run_at string
    created_at string
    created_by string [note: "Creator User ID"]
    note: "Automation triggers for Agents"
}

Table TriggerExecutions {
    id string [pk, note: "Execution ID"]
    trigger_id string
    agent_id string
    status string [note: "running, completed, failed, queued"]
    trigger_type string
    input string [note: "Generated input for the agent"]
    output string [note: "Agent output"]
    error json [note: "Error details if failed"]
    started_at string
    finished_at string
    duration_ms int
    tokens_used int
    payload json [note: "Original payload (webhook) or event data"]
    source_ip string [note: "Source IP for webhooks"]
    attempt int [note: "Retry attempt count"]
    note: "History of trigger executions"
}

Table Skills {
    id string [pk, note: "Skill ID"]
    name string [note: "Display Name"]
    function_name string [note: "Actual function name to call"]
    description string
    parameters_schema json [note: "JSON Schema for parameters"]
    owner_id string [note: "Owner User ID or 'system'"]
    visibility string [note: "public, private"]
    status string [note: "active, deprecated, error"]
    code_path string [note: "Path to implementation file or module"]
    created_at string
    updated_at string
    note: "Reusable code-based tools (Python/JS functions)"
}

Table McpServers {
    id string [pk, note: "MCP Server ID"]
    name string [note: "Server Name"]
    url string [note: "Connection URL (SSE/Stdio)"]
    config json [note: "Connection config (env vars, args)"]
    owner_id string [note: "Owner User ID or 'system'"]
    visibility string [note: "public, private"]
    status string [note: "active, error"]
    tools_cache json [note: "Cached list of tools provided by this server"]
    last_connected_at string
    created_at string
    updated_at string
    note: "Model Context Protocol Servers configuration"
}

Table AgentSkills {
    agent_id string [pk]
    skill_id string [pk]
    enabled bool [default: true]
    function_alias string [note: "Optional alias to resolve conflicts"]
    created_at string
    note: "Many-to-Many link between Agents and Skills"
}

Table AgentMcpServers {
    agent_id string [pk]
    mcp_id string [pk]
    enabled bool [default: true]
    created_at string
    note: "Many-to-Many link between Agents and MCP Servers"
}

Table KnowledgeBases {
    id string [pk, note: "KB ID"]
    name string [note: "KB Name"]
    description string
    owner_id string [note: "Owner User ID"]
    visibility string [note: "public, private"]
    status string [note: "ready, processing, error"]
    embedding_model string [note: "Model used for embeddings"]
    doc_count int [default: 0]
    chunk_count int [default: 0]
    created_at string
    updated_at string
    note: "RAG Knowledge Bases"
}

Table Documents {
    id string [pk, note: "Document ID"]
    kb_id string [note: "Knowledge Base ID"]
    name string [note: "Filename"]
    type string [note: "pdf, docx, txt, etc"]
    size_bytes long
    status string [note: "uploaded, parsing, indexed, failed"]
    error_message string
    chunk_count int
    storage_path string [note: "Path to raw file storage"]
    created_at string
    updated_at string
    note: "Documents within a Knowledge Base"
}

Table AgentKnowledgeBases {
    agent_id string [pk]
    kb_id string [pk]
    retrieval_config json [note: "Per-agent retrieval settings (top_k, threshold)"]
    created_at string
    note: "Many-to-Many link between Agents and Knowledge Bases"
}

Ref: Agents.owner_id > Users.id
Ref: Conversations.user_id > Users.id
Ref: Conversations.agent_id > Agents.id
Ref: Messages.conversation_id > Conversations.id
Ref: Messages.run_id > Runs.id
Ref: ToolCalls.message_id > Messages.id
Ref: Runs.conversation_id > Conversations.id
Ref: TokenUsage.user_id > Users.id
Ref: TokenUsage.agent_id > Agents.id
Ref: Triggers.agent_id > Agents.id
Ref: Triggers.created_by > Users.id
Ref: TriggerExecutions.trigger_id > Triggers.id
Ref: TriggerExecutions.agent_id > Agents.id
Ref: Skills.owner_id > Users.id
Ref: McpServers.owner_id > Users.id
Ref: AgentSkills.agent_id > Agents.id
Ref: AgentSkills.skill_id > Skills.id
Ref: AgentMcpServers.agent_id > Agents.id
Ref: AgentMcpServers.mcp_id > McpServers.id
Ref: KnowledgeBases.owner_id > Users.id
Ref: Documents.kb_id > KnowledgeBases.id
Ref: AgentKnowledgeBases.agent_id > Agents.id
Ref: AgentKnowledgeBases.kb_id > KnowledgeBases.id
